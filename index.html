<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HDR Gallery</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:,">
</head>
<body>

    <!-- HDR calibration tip — only shown on HDR-capable displays -->
    <div id="hdrInfoBar" class="hdr-info-bar" style="display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1bc174" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;"><polyline points="20 6 9 17 4 12"/></svg>
        <span><strong>HDR output detected</strong> — for accurate brightness <span class="hdr-info-path-tip"><strong style="color:#fffd00;">set your Windows SDR brightness slider to 31% (203 nits)</strong><span class="hdr-info-path-tooltip"><strong><span class="hdr-info-path-tooltip-text">Settings → System → Display → HDR</span><img class="hdr-info-path-tooltip-img" src="images/win_sdr_slider.jpg" alt="Windows SDR brightness slider location"></span></span></span>
    </div>

    <!-- SDR warning — shown when HDR is not active -->
    <div id="sdrInfoBar" class="hdr-info-bar hdr-info-bar-sdr" style="display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        <span><span class="sdr-browser-tip"><strong>No HDR signal detected</strong><span class="sdr-browser-tooltip"><strong>Browser HDR compatibility</strong><span class="sdr-browser-row"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#1bc174" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Chromium-based: Chrome, Edge…</span><span class="sdr-browser-row"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg> Firefox</span></span></span> — Enable HDR on Windows and use a <span class="sdr-browser-tip"><strong>compatible browser</strong><span class="sdr-browser-tooltip"><strong>Browser HDR compatibility</strong><span class="sdr-browser-row"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#1bc174" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Chromium-based: Chrome, Edge…</span><span class="sdr-browser-row"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg> Firefox</span></span></span>.</span>
    </div>

    <div class="container">
        <h1>HDR Gallery</h1>
        <div class="upload-section">
            <div class="drop-zone" id="dropZone">
                <p class="drop-zone-text">Drop Images or Click Here</p>
                <p class="drop-zone-formats">.png .avif .jxr .exr .hdr</p>
            </div>
            <input id="fileInput" type="file" multiple accept=".png,.avif,.jxr,.exr,.hdr" aria-label="Select HDR image files" style="display:none;" />
        </div>
        <div id="filterBar" class="filter-bar"></div>
        <div id="statusMessage" class="status-message"></div>
        <div class="gallery-section-header">
            <span class="gallery-section-title">Latest uploads</span>
        </div>
        <div id="gallery" class="gallery"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="db.js"></script>
    <script src="image-processing.js"></script>
    <script src="script.js"></script>
    <script>
        const hdrMq = window.matchMedia('(dynamic-range: high)');

        function updateHdrBars() {
            const isHdr = hdrMq.matches;
            document.getElementById('hdrInfoBar').style.display = isHdr ? 'flex' : 'none';
            document.getElementById('sdrInfoBar').style.display = isHdr ? 'none' : 'flex';
        }

        updateHdrBars();
        hdrMq.addEventListener('change', updateHdrBars);

        let _lastHdr = hdrMq.matches;
        setInterval(() => {
            const isHdr = hdrMq.matches;
            if (isHdr !== _lastHdr) { _lastHdr = isHdr; updateHdrBars(); }
        }, 2000);

        // Tooltip positioning — getBoundingClientRect on mouseenter so coords are always fresh
        const _tipTrigger = document.querySelector('.hdr-info-path-tip');
        const _tipBox     = document.querySelector('.hdr-info-path-tooltip');
        if (_tipTrigger && _tipBox) {
            _tipTrigger.addEventListener('mouseenter', () => {
                // Render invisibly to measure real width before positioning
                _tipBox.style.visibility = 'hidden';
                _tipBox.style.display    = 'block';
                _tipBox.style.top        = '0';
                _tipBox.style.left       = '0';

                const r    = _tipTrigger.getBoundingClientRect();
                const tipW = _tipBox.offsetWidth;
                let left   = r.left + r.width / 2 - tipW / 2;
                left       = Math.max(8, Math.min(left, window.innerWidth - tipW - 8));

                _tipBox.style.top        = (r.bottom + 8) + 'px';
                _tipBox.style.left       = left + 'px';
                _tipBox.style.visibility = 'visible';
            });
            _tipTrigger.addEventListener('mouseleave', () => {
                _tipBox.style.display = 'none';
            });
        }

        // SDR browser compatibility tooltip — shared by multiple triggers
        document.querySelectorAll('.sdr-browser-tip').forEach(_sdrTip => {
            const _sdrTipBox = _sdrTip.querySelector('.sdr-browser-tooltip');
            if (!_sdrTipBox) return;
            _sdrTip.addEventListener('mouseenter', () => {
                _sdrTipBox.style.visibility = 'hidden';
                _sdrTipBox.style.display    = 'flex';
                _sdrTipBox.style.top        = '0';
                _sdrTipBox.style.left       = '0';

                const r    = _sdrTip.getBoundingClientRect();
                const tipW = _sdrTipBox.offsetWidth;
                let left   = r.left + r.width / 2 - tipW / 2;
                left       = Math.max(8, Math.min(left, window.innerWidth - tipW - 8));

                _sdrTipBox.style.top        = (r.bottom + 8) + 'px';
                _sdrTipBox.style.left       = left + 'px';
                _sdrTipBox.style.visibility = 'visible';
            });
            _sdrTip.addEventListener('mouseleave', () => {
                _sdrTipBox.style.display = 'none';
            });
        });
    </script>

</body>
</html>